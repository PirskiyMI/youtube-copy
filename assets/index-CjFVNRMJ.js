import{r,t as v,v as E,j as e,w as S,A as w,u as d,x as R,y as U,z as W,b as h,B as Y,C as L,D as T,E as q,R as G,F as J,G as l,H as K,I as Q,J as N,K as g,M as X,N as y,q as k,d as Z,O as A,Q as $,p as D,S as ee,T as se,U as te,W as ne,X as oe,Y as p,Z as x,_ as b,$ as f,a0 as ie,a1 as ce,a2 as ae,a3 as re,a4 as le,a5 as de,a6 as F,a7 as ue,a8 as me,a9 as j,i as he,aa as xe,ab as pe,ac as je,ad as _e,ae as fe,af as ge,ag as Ce}from"./index-BCM9aTU6.js";import{P as Se}from"./index-BxFZZY7T.js";const I=()=>{const[s,t]=r.useState(!1);return{isPopupVisible:s,showPopup:()=>t(!0),hidePopup:()=>t(!1)}},B=()=>{const[s,t]=r.useState(!1),[o,n]=r.useState(!1),i=r.useRef(null);return r.useEffect(()=>{i.current&&n(i.current.clientHeight!==i.current.scrollHeight)},[]),{isTextShow:s,isButtonShow:o,ref:i,toggleIsTextShow:()=>t(!s)}},Ne=({title:s,subscriberCount:t})=>{const o=v(t),n=E(Number(t),"подписчик","подписчика","подписчиков");return e.jsxs("div",{className:S.channel,children:[e.jsx(w,{}),e.jsxs("div",{className:S.channel__info,children:[e.jsx("h4",{className:S.channel__title,children:s}),e.jsxs("span",{children:[o," ",n]})]})]})},be=({channelId:s})=>{d(R);const t=d(U),o=d(W),n=h();return r.useEffect(()=>{n(Y(s))},[s]),e.jsx(Ne,{title:t,subscriberCount:o})},ke=s=>s.videoPlayer.title,ve=({src:s})=>{const{setVideoId:t}=T,o=h();return r.useEffect(()=>{o(t(s))},[s,o]),e.jsx("div",{className:L.video,children:e.jsx("iframe",{className:L.video__iframe,src:s,title:"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})})},we=s=>s.relatedVideo,Ve=()=>{const{clearVideoList:s}=J,{videoList:t,loading:o}=d(we),n=d(ke),i=h();return r.useEffect(()=>(n&&i(q(n)),()=>{i(s())}),[n,i,s]),o?e.jsx(e.Fragment,{}):e.jsx(G,{videoList:t})},Le=({authorDisplayName:s,textDisplay:t,publishedAt:o})=>{const{ref:n,isTextShow:i,isButtonShow:c,toggleIsTextShow:a}=B();return e.jsxs("div",{className:l.comment,children:[e.jsx(w,{}),e.jsxs("div",{className:l.comment__content,children:[e.jsxs("div",{className:l.comment__header,children:[e.jsx("h3",{className:l.comment__author,children:s}),e.jsx("span",{children:K(o).fromNow()})]}),e.jsx("p",{ref:n,className:i?l.comment__text:`${l.comment__text} ${l.comment__text_hidden}`,children:t}),c?e.jsx("button",{onClick:a,className:l.comment__open,children:i?"Свернуть":"Читать дальше"}):null]})]})},ye=({authorDisplayName:s,publishedAt:t,textDisplay:o,replies:n,totalReplyCount:i})=>{const[c,a]=r.useState(!1),{ref:u,isTextShow:m,isButtonShow:_,toggleIsTextShow:C}=B(),z=Q(t),O=i?E(Number(i),"ответ","ответа","ответов"):null;return e.jsxs("div",{className:l.comment,children:[e.jsx(w,{}),e.jsxs("div",{className:l.comment__content,children:[e.jsxs("div",{className:l.comment__header,children:[e.jsx("h3",{className:l.comment__author,children:s}),e.jsx("span",{children:z})]}),e.jsx("div",{ref:u,className:m?l.comment__text:`${l.comment__text} ${l.comment__text_hidden}`,children:o}),_?e.jsx("button",{onClick:C,className:l.comment__open,children:m?"Свернуть":"Читать дальше"}):null,i?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:l.comment__button,onClick:()=>a(!c),children:[i," ",O]}),c&&n?e.jsx("ul",{className:l.comment__list,children:n.map(V=>e.jsx("li",{children:e.jsx(Le,{...V})},V.id))}):null]}):null]})]})},$e=({commentText:s,setCommentText:t,setIsFetching:o})=>{const n=c=>{t(c.target.value)},i=c=>{c.preventDefault(),o(!0)};return e.jsxs("form",{onSubmit:i,className:N.form,children:[e.jsx("input",{value:s,onChange:n,placeholder:"Введите комментарий",className:N.form__field}),e.jsx(g,{className:N.form__button,disabled:s.length<1,children:"Оставить комментарий"})]})},Pe=({videoId:s})=>{const[t,o]=r.useState(!1),[n,i]=r.useState(""),c=h();return r.useEffect(()=>{t&&(c(X({videoId:s,text:n})),i(""),o(!1))},[c,t]),e.jsx($e,{commentText:n,setCommentText:i,setIsFetching:o})},Ee=()=>e.jsxs("div",{className:y.form,children:[e.jsx("h3",{className:y.from__title,children:"Чтобы оставить комментарий к этому видео, войдите в аккаунт"}),e.jsx(k,{})]}),Re=({videoId:s,nextPageToken:t,loading:o,isAuth:n,commentList:i})=>{const{ref:c,inView:a}=Z({threshold:.9}),u=h();return r.useEffect(()=>{a&&u(A({videoId:s,token:t,maxResults:20}))},[a]),e.jsxs(e.Fragment,{children:[e.jsx(r.Suspense,{children:n?e.jsx(Pe,{videoId:s}):e.jsx(Ee,{})}),e.jsx("ul",{className:$.list,children:i.map((m,_,C)=>e.jsx("li",{ref:_===C.length-1?c:null,children:e.jsx(ye,{...m})},m.id))}),o&&e.jsx("div",{className:$.preloader,children:e.jsx(Se,{})})]})},Te=({videoId:s})=>{const{clearCommentList:t}=oe,o=d(D),n=d(ee),i=d(se),c=d(te),a=d(ne),u=h();return r.useEffect(()=>(u(A({videoId:s,token:i,maxResults:40})),()=>{u(t())}),[]),a?e.jsx("div",{children:a}):c&&!n.length?e.jsx(e.Fragment,{}):e.jsx(Re,{videoId:s,commentList:n,nextPageToken:i,loading:c,isAuth:o})},Ae=s=>r.createElement("svg",{width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},r.createElement("path",{d:"M8 10V20M8 10L4 9.99998V20L8 20M8 10L13.1956 3.93847C13.6886 3.3633 14.4642 3.11604 15.1992 3.29977L15.2467 3.31166C16.5885 3.64711 17.1929 5.21057 16.4258 6.36135L14 9.99998H18.5604C19.8225 9.99998 20.7691 11.1546 20.5216 12.3922L19.3216 18.3922C19.1346 19.3271 18.3138 20 17.3604 20L8 20",stroke:"#000000",strokeWidth:.6,strokeLinecap:"round",strokeLinejoin:"round"})),De=s=>r.createElement("svg",{width:"800px",height:"800px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},r.createElement("path",{d:"M8 14V4M8 14L4 14V4.00002L8 4M8 14L13.1956 20.0615C13.6886 20.6367 14.4642 20.884 15.1992 20.7002L15.2467 20.6883C16.5885 20.3529 17.1929 18.7894 16.4258 17.6387L14 14H18.5604C19.8225 14 20.7691 12.8454 20.5216 11.6078L19.3216 5.60779C19.1346 4.67294 18.3138 4.00002 17.3604 4.00002L8 4",stroke:"#000000",strokeWidth:.6,strokeLinecap:"round",strokeLinejoin:"round"})),M=({likeCount:s,rate:t,onLikeClick:o,onDislikeClick:n})=>e.jsxs("div",{className:p.rate,children:[e.jsxs("button",{className:p.rate__button,onClick:o,children:[e.jsx(Ae,{className:p.rate__icon+(t==="like"?` ${p.rate__icon_active}`:"")}),e.jsx("span",{children:s})]}),e.jsx("button",{className:p.rate__button,onClick:n,children:e.jsx(De,{className:p.rate__icon+(t==="dislike"?` ${p.rate__icon_active}`:"")})})]}),Fe=({viewCount:s,viewNoun:t,publishedAt:o,description:n})=>{const[i,c]=r.useState(!1),a=()=>c(!0),u=m=>{m.stopPropagation(),c(!1)};return e.jsxs("div",{className:i?`${x.info} ${x.info_active}`:x.info,onClick:a,children:[e.jsxs("div",{className:x.info__statistics,children:[e.jsxs("span",{children:[s," ",t]}),e.jsx("span",{children:o})]}),e.jsx("div",{className:i?`${x.info__content} ${x.info__content_active}`:x.info__content,dangerouslySetInnerHTML:{__html:n}}),i?e.jsx("button",{className:x.info__button,onClick:u,children:"Свернуть"}):e.jsx("button",{className:x.info__button,children:"ещё..."})]})},Ie=({rate:s,likeCount:t,onLikeClick:o,onDislikeClick:n})=>{const i=v(t);return e.jsx(M,{rate:s,likeCount:i,onLikeClick:o,onDislikeClick:n})},Be=({videoId:s,rate:t,...o})=>{const n=h(),i=()=>n(b({videoId:s,rate:"like"})),c=()=>n(b({videoId:s,rate:"dislike"})),a=()=>n(b({videoId:s,rate:"none"})),u=t!=="like"?i:a,m=t!=="dislike"?c:a;return e.jsx(Ie,{rate:t,onLikeClick:u,onDislikeClick:m,...o})},H=({title:s,text:t,hidePopup:o,button:n})=>e.jsxs("div",{className:f.popup,children:[e.jsx("div",{className:f.popup__backdrop,onClick:o}),e.jsxs("div",{className:f.popup__body,children:[e.jsxs("div",{className:f.popup__text,children:[e.jsx("p",{children:s}),e.jsx("p",{children:t})]}),n&&e.jsx("div",{className:f.popup__button,children:n})]})]}),Me=({likeCount:s,authButton:t})=>{const{isPopupVisible:o,showPopup:n,hidePopup:i}=I(),c=v(s);return e.jsxs("div",{className:ie.counter,children:[e.jsx(M,{likeCount:c,rate:"none",onLikeClick:n,onDislikeClick:n}),o&&e.jsx(H,{title:"Хотите оценить это видео?",text:"Тогда войдите в аккаунт.",hidePopup:i,button:t})]})},He=({handleDeleteSubscription:s})=>e.jsx(g,{onClick:s,className:ce.button,children:"Отменить подписку"}),ze=({subscribeStatus:s})=>{const{clearSubscriptionStatus:t}=re,o=h(),n=()=>{o(ae(s)),o(t())};return e.jsx(He,{handleDeleteSubscription:n})},Oe=({disabled:s,handleCreateSubscription:t})=>e.jsx(g,{onClick:t,disabled:s,children:"Подписаться"}),Ue=({channelId:s})=>{const t=d(R),o=h(),n=()=>{o(le(s))};return e.jsx(Oe,{handleCreateSubscription:n,disabled:t})},We=({authButton:s})=>{const{isPopupVisible:t,showPopup:o,hidePopup:n}=I();return e.jsxs("div",{className:de.button,children:[e.jsx(g,{onClick:o,children:"Подписаться"}),t&&e.jsx(H,{title:"Хотите подписаться на этот канал?",text:"Тогда войдите в аккаунт.",hidePopup:n,button:s})]})},Ye=()=>e.jsx(F,{className:ue.skeleton}),qe=()=>e.jsx(F,{className:me.skeleton}),Ge=({videoId:s,isAuth:t,subscribeStatus:o,videoRating:n,details:{channelId:i,title:c,description:a,likeCount:u,viewCount:m,publishedAt:_}})=>e.jsxs("div",{className:j.description,children:[e.jsx("div",{className:j.description__header,children:e.jsx("h3",{className:j.description__title,children:c})}),e.jsxs("div",{className:j.description__main,children:[e.jsx(be,{channelId:i}),e.jsxs("div",{className:j.description__controls,children:[e.jsx(r.Suspense,{fallback:e.jsx(qe,{}),children:t?e.jsx(Be,{videoId:s,likeCount:u,rate:n}):e.jsx(Me,{likeCount:u,authButton:e.jsx(k,{})})}),e.jsx(r.Suspense,{fallback:e.jsx(Ye,{}),children:t?o?e.jsx(ze,{subscribeStatus:o}):e.jsx(Ue,{channelId:i}):e.jsx(We,{authButton:e.jsx(k,{})})})]})]}),e.jsx("div",{className:j.description__footer,children:e.jsx(Fe,{description:a,...he({publishedAt:_,viewCount:m})})})]}),Je=({videoId:s})=>{const t=d(xe),o=d(pe),n=d(je),i=d(D),{setVideoTitle:c}=T,a=h();return r.useEffect(()=>{a(_e(s))},[a,s]),r.useEffect(()=>{i&&a(fe(s))},[a,s,i]),r.useEffect(()=>{t!=null&&t.channelId&&i&&a(ge(t==null?void 0:t.channelId))},[t==null?void 0:t.channelId,a,i]),r.useEffect(()=>(t!=null&&t.title&&a(c(t==null?void 0:t.title)),()=>{a(c(""))}),[t==null?void 0:t.title,a,c]),t?e.jsx(Ge,{details:t,isAuth:i,subscribeStatus:o,videoId:s,videoRating:n}):e.jsx(e.Fragment,{})},Ke="_page_1hpsj_1",Qe="_page__main_1hpsj_9",P={page:Ke,page__main:Qe},es=()=>{const{id:s}=Ce();return e.jsxs("div",{className:P.page,children:[e.jsxs("div",{className:P.page__main,children:[e.jsx(ve,{src:`https://www.youtube.com/embed/${s}`}),e.jsx(Je,{videoId:s}),e.jsx(Te,{videoId:s})]}),e.jsx("div",{children:e.jsx(Ve,{})})]})};export{es as ViewPage};
